# 伤害计算器 - 使用说明

## 项目简介

这是一个游戏角色伤害期望值计算器，支持：
- 计算不同装备组合下的期望伤害
- 对比所有装备方案
- 找出最优配置方案

## 文件说明

- `main.py` - 核心计算逻辑（命令行版本）
- `ui.py` - 图形界面版本
- `test.py` - 批量测试脚本
- `characters.yml` - 角色配置文件
- `requirements.txt` - Python依赖

## 伤害计算公式

```
期望伤害 = (base * (1 + x%) + y) * (1 + 伤害加成z%) * (1 + (暴击率 * 爆伤加成)) * 技能倍率
```

**说明：**
- base: 基础攻击力或基础生命值
- x%: 攻击百分比或生命百分比
- y: 固定攻击或固定生命
- z%: 伤害加成百分比
- 技能倍率: 角色技能的伤害倍率

## 装备类型

### 4类装备（原A类）
- 主词条爆伤44% + 副词条固定攻击150
- 主词条暴击22% + 副词条固定攻击150

### 3类装备（原B类）
- 主词条生命30% + 副词条固定攻击100
- 主词条攻击30% + 副词条固定攻击100
- 主词条伤害加成30% + 副词条固定攻击100

### 1类装备（原C类）
- 主词条生命22.8% + 副词条固定生命2280
- 主词条攻击18% + 副词条固定生命2280

## 装备组合方案

程序会计算以下三种组合（共5件装备）：
- **44111**: 2件4类 + 3件1类
- **43311**: 1件4类 + 2件3类 + 2件1类
- **43111**: 1件4类 + 1件3类 + 3件1类

## 使用方法

### 方式1：图形界面（推荐）

```bash
python ui.py
```

**界面功能：**

1. **使用现有角色**
   - 从下拉框选择已配置的角色
   - 点击"计算最优方案"查看结果

2. **自定义新角色**
   - 选择"自定义新角色"模式
   - 填写角色各项属性
   - 点击"计算最优方案"查看结果
   - 可选：点击"保存为新角色"将配置保存到文件

3. **结果说明**
   - 先显示所有三种组合方案对比
   - 再显示最优方案的详细装备配置
   - 包含完整的伤害计算过程

### 方式2：命令行

```bash
python main.py
```

按提示输入角色编号或名称即可。

### 方式3：批量测试

```bash
python test.py
```

自动计算配置文件中所有角色的最优方案。

## 角色配置文件格式

`characters.yml` 文件示例：

```yaml
characters:
  角色A:
    base_type: attack      # 类型: attack(攻击型) 或 hp(生命型)
    base_value: 2000       # 基础攻击力或生命值
    base_crit_rate: 0.05   # 基础暴击率 (0.05 = 5%)
    base_crit_dmg: 0.50    # 基础暴击伤害 (0.50 = 50%)
    base_dmg_bonus: 0.0    # 基础伤害加成 (0.0 = 0%)
    skill_multiplier: 2.5  # 技能倍率 (2.5 = 250%)
```

## 输入说明

- **基础数值**: 攻击型角色填基础攻击力，生命型角色填基础生命值
- **百分比数值**: 使用小数表示，如5%填0.05，50%填0.50
- **技能倍率**: 攻击型通常2.0-3.0，生命型通常0.05-0.15

## 输出说明

### 方案对比部分
显示三种装备组合的最优配置，包括：
- 方案名称（44111/43311/43111）
- 关键属性（攻击力/生命值、暴击率、爆伤、伤害加成）
- 期望伤害
- 与最优方案的差距

### 详细结果部分
显示最优方案的完整信息：
- 五件装备的具体词条
- 总属性汇总
- 伤害计算过程分解
- 最终期望伤害值

## 常见问题

**Q: 技能倍率不影响最优方案选择吗？**

A: 是的。技能倍率是一个常数乘数，对所有方案影响相同，不会改变方案优劣顺序。但它会影响最终伤害数值，让计算结果更接近实际游戏表现。

**Q: 如何添加新角色？**

A: 三种方式：
1. 使用UI的"自定义新角色"模式，填写后点击"保存为新角色"
2. 直接编辑 `characters.yml` 文件添加
3. 在命令行模式下计算自定义配置（不会保存）

**Q: 暴击率超过100%怎么办？**

A: 程序会自动将暴击率限制在100%以内进行计算。

## 技术依赖

```bash
pip install -r requirements.txt
```

主要依赖：
- Python 3.7+
- PyYAML (配置文件读写)
- tkinter (GUI，Python自带)

## 联系与反馈

如有问题或建议，欢迎反馈！
